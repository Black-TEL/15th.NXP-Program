/********************?eòY3?**************************????±?ía?óSCK,SDAé?à-μ?×è
*****************0.96  4PIN IIC OLED FOR STM32F103*************
*****STM32F103?y?ˉ**************************
***** PB5----3  SCK   ,  PB6----4  SDA   ,    
***** BY:GU 
********************************************************/

#include "common.h"
#include "MK60_gpio.h"
#include "OLED.h"
#include "MK60_conf.h"
#include "include.h"

struct
{
    int x;
    int y;
}move;
//const unsigned char  *point;
unsigned char ACK=0;
const unsigned char  OLED_init_cmd[25]=
{
  /*0xae,0X00,0X10,0x40,0X81,0XCF,0xff,0xa1,0xa4,
  0xA6,0xc8,0xa8,0x3F,0xd5,0x80,0xd3,0x00,0XDA,0X12,
  0x8d,0x14,0xdb,0x40,0X20,0X02,0xd9,0xf1,0xAF*/
       0xAE,//1?±???ê?
       0xD5,//éè??ê±?ó・??μòò×ó,?eμ′?μ?ê
       0x80,  //[3:0],・??μòò×ó;[7:4],?eμ′?μ?ê

       0xA8,//éè???y?ˉ?・êy
       0X3F,//??è?0X3F(1/64)
       0xD3,//éè????ê???ò?
       0X00,//??è??a0
       0x40,//éè????ê??aê?DD [5:0],DDêy.                              
       0x8D,//μ?oé±?éè??
       0x14,//bit2￡??a??/1?±?
       0x20,//éè???ú′?μ??・?￡ê?
       0x02,//[1:0],00￡?áDμ??・?￡ê?;01￡?DDμ??・?￡ê?;10,ò3μ??・?￡ê?;??è?10;
       0xA1,//?????¨ò?éè??,bit0:0,0->0;1,0->127;
       0xC8,//éè??COMé¨?è・??ò;bit3:0,??í¨?￡ê?;1,???¨ò??￡ê? COM[N-1]->COM0;N:?y?ˉ?・êy
       0xDA,//éè??COMó2?tòy??????
       0x12,//[5:4]????            
       0x81,//??±è?èéè??
       0xEF,//1~255;??è?0X7F (áá?èéè??,??′ó??áá)
       0xD9,//éè???¤3?μ??ü?ú
       0xf1,//[3:0],PHASE 1;[7:4],PHASE 2;
       0xDB,//éè??VCOMH μ??1±??ê
       0x30,//[6:4] 000,0.65*vcc;001,0.77*vcc;011,0.83*vcc;
       0xA4,//è?????ê??a??;bit0:1,?a??;0,1?±?;(°×?á/oú?á)
       0xA6,//éè????ê?・?ê?;bit0:1,・′?à??ê?;0,?y3￡??ê?        
       0xAF,//?a????ê?     
};

int LEVEL=0;
unsigned char number[11][2][8]={
0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00,//0
0x00,0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,//1
0x00,0x70,0x08,0x08,0x08,0x08,0xF0,0x00,0x00,0x30,0x28,0x24,0x22,0x21,0x30,0x00,//2
0x00,0x30,0x08,0x08,0x08,0x88,0x70,0x00,0x00,0x18,0x20,0x21,0x21,0x22,0x1C,0x00,//3
0x00,0x00,0x80,0x40,0x30,0xF8,0x00,0x00,0x00,0x06,0x05,0x24,0x24,0x3F,0x24,0x24,//4
0x00,0xF8,0x88,0x88,0x88,0x08,0x08,0x00,0x00,0x19,0x20,0x20,0x20,0x11,0x0E,0x00,//5
0x00,0xE0,0x10,0x88,0x88,0x90,0x00,0x00,0x00,0x0F,0x11,0x20,0x20,0x20,0x1F,0x00,//6
0x00,0x18,0x08,0x08,0x88,0x68,0x18,0x00,0x00,0x00,0x00,0x3E,0x01,0x00,0x00,0x00,//7
0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00,//8
0x00,0xF0,0x08,0x08,0x08,0x10,0xE0,0x00,0x00,0x01,0x12,0x22,0x22,0x11,0x0F,0x00,//9
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,0x00,0x00,//小数点
};

unsigned char Printf[4][2][16][8]={
0x40,0x40,0x42,0xCC,0x00,0x04,0xF4,0x94, 0x94,0xFF,0x94,0x94,0xF4,0x04,0x00,0x00,
0x00,0x00,0xFC,0x24,0x24,0x24,0xFC,0x25, 0x26,0x24,0xFC,0x24,0x24,0x24,0x04,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0xC8,0xB8,0x8F,0xE8,0x88,0x88,0x40,0x48, 0x48,0xE8,0x5F,0x48,0x48,0x48,0x40,0x00,
0x00,0xF8,0x08,0x08,0x0C,0xCA,0x49,0x48, 0x48,0xC8,0x08,0x08,0x08,0xF8,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//第一行
0x00,0x40,0x20,0x1F,0x20,0x48,0x44,0x42, 0x41,0x5F,0x41,0x42,0x44,0x48,0x40,0x00,
0x40,0x30,0x8F,0x80,0x84,0x4C,0x55,0x25, 0x25,0x25,0x55,0x4C,0x80,0x80,0x80,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x08,0x18,0x08,0xFF,0x04,0x04,0x00,0x02, 0x0B,0x12,0x22,0xD2,0x0A,0x06,0x00,0x00,
0x00,0xFF,0x00,0x00,0x00,0x1F,0x08,0x08, 0x08,0x1F,0x00,0x40,0x80,0x7F,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//第二行
0x08,0xF8,0x08,0x08,0x08,0x08,0xF0,0x00, 0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x08,0xF8,0x08,0x08,0x08,0x08,0xF0,0x00, 0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//第三行
0x20,0x3F,0x21,0x01,0x01,0x01,0x00,0x00, 0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x20,0x3F,0x21,0x01,0x01,0x01,0x00,0x00, 0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//第四行
0x00,0x08,0x08,0xF8,0x08,0x08,0x00,0x00, 0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x08,0x08,0xF8,0x08,0x08,0x00,0x00, 0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//第五行
0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00, 0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00, 0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//第六行
0x08,0xF8,0x08,0x08,0x08,0x10,0xE0,0x00, 0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x08,0xF8,0x08,0x08,0x08,0x10,0xE0,0x00, 0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//第七行
0x20,0x3F,0x20,0x20,0x20,0x10,0x0F,0x00, 0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x20,0x3F,0x20,0x20,0x20,0x10,0x0F,0x00, 0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//第八行
};

void OLED_IIC_init(void)
{
     gpio_init  (OLED_SCL_IO, GPO, 1); //初始化SCL
     gpio_init  (OLED_SDA_IO, GPO, 1); //初始化SDA
    
     port_init_NoALT(OLED_SCL_IO,ODO | PULLUP);
     port_init_NoALT(OLED_SDA_IO,ODO | PULLUP);
}

void OLED_delay_us(unsigned int _us_time)
{       
  unsigned char x=0;
  for(;_us_time>0;_us_time--)
  {
    x++;x++;x++;x++;x++;x++;x++;x++;x++;x++;x++;x++;
	  x++;x++;x++;x++;x++;x++;x++;x++;x++;x++;x++;x++;
	  x++;x++;x++;x++;x++;x++;x++;x++;x++;x++;x++;x++;
  }
}

void OLED_delay_ms(unsigned int _ms_time)
  {
    unsigned int i,j;
    for(i=0;i<_ms_time;i++)
    {
    for(j=0;j<900;j++)
      {;}
    }
  }

/**************************IIC?￡?é・￠?íoˉêy************************************************

 *************************************************************************/
//写入 最后将SDA拉高，以等待从设备产生应答
void OLED_IIC_write(unsigned char date)
{
	unsigned char i, temp;
	temp = date;
			
	for(i=0; i<8; i++)
	{	OLED_IIC_SCL_0;
		
        if ((temp&0x80)==0)
            OLED_IIC_SDA_0;
        else OLED_IIC_SDA_1;
		temp = temp << 1;
		OLED_delay_us(1);			  
		OLED_IIC_SCL_1;
		OLED_delay_us(1);
		
	}
	OLED_IIC_SCL_0;
	OLED_delay_us(1);
	OLED_IIC_SDA_1;
	OLED_delay_us(1);
	OLED_IIC_SCL_1;
//		不需要应答						
//	if (READ_SDA==0)
//		ACK = 1;
//	else ACK =0;
	OLED_delay_us(1);
	OLED_IIC_SCL_0;
	OLED_delay_us(1);
	

}
//启动信号
//SCL在高电平期间，SDA有高电平想低电平的变化定义为启动信号
void OLED_IIC_start()
{
	OLED_IIC_SDA_1;
	OLED_delay_us(1);
	OLED_IIC_SCL_1;
	OLED_delay_us(1);				   //所有操作结束释放SCL	
	OLED_IIC_SDA_0;
	OLED_delay_us(3);
	OLED_IIC_SCL_0;
	
        OLED_IIC_write(0x78);
        
}

//停止信号
//SCL在高电平期间，SDA有低电平想高电平的变化定义为停止信号
void OLED_IIC_stop()
{
	OLED_IIC_SDA_0;
	OLED_delay_us(1);
	OLED_IIC_SCL_1;
	OLED_delay_us(3);
	OLED_IIC_SDA_1;
	
}

void OLED_send_cmd(unsigned char o_command)
  {
    
    OLED_IIC_start();
    OLED_IIC_write(0x00); 
    OLED_IIC_write(o_command);
    OLED_IIC_stop();
    
  }
void OLED_send_data(unsigned char o_data)
  { 
    OLED_IIC_start();
    OLED_IIC_write(0x40);
    OLED_IIC_write(o_data);
    OLED_IIC_stop();
   }
void Column_set(unsigned char column)
  {
    OLED_send_cmd(0x10|(column>>4));    //设置列地址高位
    OLED_send_cmd(0x00|(column&0x0f));   //设置列地址地位  
    	 
  }
void Page_set(unsigned char page)
  {
    OLED_send_cmd(0xb0+page);
  }
void OLED_clear(void)
  {
    unsigned char page,column;
    for(page=0;page<8;page++)             //page loop
      { 
          Page_set(page);
          Column_set(0);	  
          for(column=0;column<128;column++)	//column loop
            {
              OLED_send_data(0x00);
            }
      }
  }
void OLED_full(void)
  {
    unsigned char page,column;
    for(page=0;page<8;page++)             //page loop
      { 
        Page_set(page);
        Column_set(0);	  
	for(column=0;column<128;column++)	//column loop
          {
            OLED_send_data(0xff);
          }
      }
  }
void OLED_init(void)
  {
    unsigned char i;
    for(i=0;i<25;i++)
      {
        OLED_send_cmd(OLED_init_cmd[i]);
      }
  }

void Picture_display(const unsigned char *ptr_pic)
  {
    unsigned char page,column;
    for(page=0;page<(64/8);page++)        //page loop
      { 
	Page_set(page);
	Column_set(0);	  
	for(column=0;column<128;column++)	//column loop
          {
            OLED_send_data(*ptr_pic++);
          }
      }
  }
void Picture_ReverseDisplay(const unsigned char *ptr_pic)
{
    unsigned char page,column,data;
    for(page=0;page<(64/8);page++)        //page loop
      { 
	Page_set(page);
	Column_set(0);	  
	for(column=0;column<128;column++)	//column loop
          {
            data=*ptr_pic++;
            data=~data;
            OLED_send_data(data);
          }
      }
 }

void OLED_Printf(int x,int y, float data)
{
    Digit digit;
    digit.one = (int)data%10;
    digit.ten = ((int)data/10)%10;
    digit.hundred = (int)data/100;
    setPlace(x-1, y-1, digit.hundred);
    setPlace(x, y-1, digit.ten);
    setPlace(x+1, y-1, digit.one);
}

void setPlace(int x, int y, int data)
{
    int i,j;
    for(i=0;i<2;i++)
    {
      for(j=0;j<8;j++)
      {
         Printf[y][i][x][j] = number[data][i][j];
      }
    }
}

/*
 *调试界面显示特殊处理
 */
void Debug_OLED_Printf(int x,int y, float data)
{
    Digit digit;
    digit.one = (int)data%10;
    digit.ten = ((int)data/10)%10;
    digit.hundred = (int)data/100;
    Debug_setPlace(x, y, digit.hundred);
    Debug_setPlace(x+1, y, digit.ten);
    Debug_setPlace(x+2, y, digit.one);
}

/*
 *调试参数位置放置特殊处理
 */
void Debug_setPlace(int x, int y, int data)
{
    int i,j;
    for(i=0;i<2;i++)
    {
      for(j=0;j<8;j++)
      {
         Printf[y][i][x][j] = ~number[data][i][j];
      }
    }
}

/******************************************************************************/
/*                       独立按键调参相关程序                                  */
/******************************************************************************/

/*
 * 调试界面初始化
 */
void Debug_display_init()
{
    int i,j;
    move.x = 0;
    move.y = 1;
    for(i=0;i<2;i++)
    {
      for(j=0;j<8;j++)
      {
        Printf[move.y][i][move.x][j] = ~Printf[move.y][i][move.x][j];
      }
    }
    Picture_display(&Printf[0][0][0][0]);
}

/*
 *更改PID参数界面初始化
 */
void Change_PID_Init()
{
    int i,j,k;
    for(i=0;i<2;i++)
    {
      for(j=0;j<8;j++)
      {
        Printf[move.y][i][move.x][j] = ~Printf[move.y][i][move.x][j];
      }
    }
    move.x += 2;
    for(k=0;k<6;k++)
    {
      for(i=0;i<2;i++)
      {
        for(j=0;j<8;j++)
        {
          Printf[move.y][i][move.x+k][j] = ~Printf[move.y][i][move.x+k][j];
        }
      }
    }
    Picture_display(&Printf[0][0][0][0]);
}

/*
 *更改PID参数
 */
void Change_PID()
{
    if(gpio_get(key_Up) == 0)
    {
      DELAY_MS(5);
      if(gpio_get(key_Up) == 0)
      {
        if(move.y == 1 && move.x == 2)
        {
          Speed_PID.Kp++;
          Debug_OLED_Printf(move.x, move.y, Speed_PID.Kp);
        }
        if(move.y == 2 && move.x == 2)
        {
          Speed_PID.Ki++;
          Debug_OLED_Printf(move.x, move.y, Speed_PID.Ki);
        }
        if(move.y == 3 && move.x == 2)
        {
          Speed_PID.Kd++;
          Debug_OLED_Printf(move.x, move.y, Speed_PID.Kd);
        }
        if(move.y == 1 && move.x == 10)
        {
          Turn_PID.Kp++;
          Debug_OLED_Printf(move.x, move.y, Turn_PID.Kp);
        }
        if(move.y == 2 && move.x == 10)
        {
          Turn_PID.Ki++;
          Debug_OLED_Printf(move.x, move.y, Turn_PID.Ki);
        }
        if(move.y == 3 && move.x == 10)
        {
          Turn_PID.Kd++;
          Debug_OLED_Printf(move.x, move.y, Turn_PID.Kd);
        }
        while(!(gpio_get(key_Up)));
        OLED_clear();
      }
    }
    if(gpio_get(key_Down) == 0)
    {
      DELAY_MS(5);
      if(gpio_get(key_Down) == 0)
      {
        if(move.y == 1 && move.x == 2)
        {
          Speed_PID.Kp--;
          Debug_OLED_Printf(move.x, move.y, Speed_PID.Kp);
        }
        if(move.y == 2 && move.x == 2)
        {
          Speed_PID.Ki--;
          Debug_OLED_Printf(move.x, move.y, Speed_PID.Ki);
        }
        if(move.y == 3 && move.x == 2)
        {
          Speed_PID.Kd--;
          Debug_OLED_Printf(move.x, move.y, Speed_PID.Kd);
        }
        if(move.y == 1 && move.x == 10)
        {
          Turn_PID.Kp--;
          Debug_OLED_Printf(move.x, move.y, Turn_PID.Kp);
        }
        if(move.y == 2 && move.x == 10)
        {
          Turn_PID.Ki--;
          Debug_OLED_Printf(move.x, move.y, Turn_PID.Ki);
        }
        if(move.y == 3 && move.x == 10)
        {
          Turn_PID.Kd--;
          Debug_OLED_Printf(move.x, move.y, Turn_PID.Kd);
        }
        while(!(gpio_get(key_Down)));
        OLED_clear();
      }
    }
    Picture_display(&Printf[0][0][0][0]);
}

/*
 *退出更改PID参数
 */
void Change_PID_Exit()
{
    int i,j,k;
    for(k=0;k<6;k++)
    {
      for(i=0;i<2;i++)
      {
        for(j=0;j<8;j++)
        {
          Printf[move.y][i][move.x+k][j] = ~Printf[move.y][i][move.x+k][j];
        }
      }
    }
    move.x -= 2;
    for(i=0;i<2;i++)
    {
      for(j=0;j<8;j++)
      {
        Printf[move.y][i][move.x][j] = ~Printf[move.y][i][move.x][j];
      }
    }
    Picture_display(&Printf[0][0][0][0]);
}

/*
 *PID参数选择 
 */
void Choice_PID()                                                          
{   
    int i,j;
    if(gpio_get(key_Up) == 0)
    {
      DELAY_MS(5);
      if(gpio_get(key_Up) == 0)
      {
        move.y--;
        for(i=0;i<2;i++)
        {
          for(j=0;j<8;j++)
          {
            Printf[move.y][i][move.x][j] = ~Printf[move.y][i][move.x][j];
            Printf[move.y+1][i][move.x][j] = ~Printf[move.y+1][i][move.x][j];
          }
        }
        while(!(gpio_get(key_Up)));
        OLED_clear();
      }
    }
    if(gpio_get(key_Down) == 0)
    {
      DELAY_MS(5);
      if(gpio_get(key_Down) == 0)
      {
        move.y++;      
        for(i=0;i<2;i++)
        {
          for(j=0;j<8;j++)
          {
            Printf[move.y][i][move.x][j] = ~Printf[move.y][i][move.x][j];
            Printf[move.y-1][i][move.x][j] = ~Printf[move.y-1][i][move.x][j];
          }
        }
        while(!(gpio_get(key_Up)));
        OLED_clear();
      }
    }
    if(gpio_get(key_Right) == 0)
    {
      DELAY_MS(5);
      if(gpio_get(key_Right) == 0)
      {
        move.x+=8;
        for(i=0;i<2;i++)
        {
          for(j=0;j<8;j++)
          {
            Printf[move.y][i][move.x][j] = ~Printf[move.y][i][move.x][j];
            Printf[move.y][i][move.x-8][j] = ~Printf[move.y][i][move.x-8][j];
          }
        }
        while(!(gpio_get(key_Right)));
        OLED_clear();
      }
    }
    if(gpio_get(key_Left) == 0)
    {
      DELAY_MS(5);
      if(gpio_get(key_Left) == 0)
      {
        move.x-=8;
        for(i=0;i<2;i++)
        {
          for(j=0;j<8;j++)
          {
            Printf[move.y][i][move.x][j] = ~Printf[move.y][i][move.x][j];
            Printf[move.y][i][move.x+8][j] = ~Printf[move.y][i][move.x+8][j];
          }
        }
        while(!(gpio_get(key_Left)));
        OLED_clear();
      }
    }
    Picture_display(&Printf[0][0][0][0]);
}

/*
 *退出PID参数选择
 */
void Choice_PID_Exit()
{
    int i,j;
    for(i=0;i<2;i++)
    {
      for(j=0;j<8;j++)
      {
        Printf[move.y][i][move.x][j] = ~Printf[move.y][i][move.x][j];
      }
    }
    Picture_display(&Printf[0][0][0][0]);
}

void Debue_Key()
{
  if(gpio_get(key_Enter) == 0)
  {
    DELAY_MS(5);
    if(gpio_get(key_Enter) == 0)
    {
      LEVEL++;
      Debug_display_init();
      while(!(gpio_get(key_Enter)));
      while(LEVEL == LEVEL1)
      {
        Choice_PID();
        if(gpio_get(key_Enter) == 0)
        {
          DELAY_MS(5);
          if(gpio_get(key_Enter) == 0)
          {
            LEVEL++;
            Change_PID_Init();
            while(!(gpio_get(key_Enter)));
            while(LEVEL == LEVEL2)
            {
              Change_PID();
              if(gpio_get(key_Exit) == 0)
              {
                DELAY_MS(5);
                if(gpio_get(key_Exit) == 0) LEVEL--;
                Change_PID_Exit();
                while(!(gpio_get(key_Exit)));
              }
            }
          }
        }
        if(gpio_get(key_Exit) == 0)
        {
          DELAY_MS(5);
          if(gpio_get(key_Exit) == 0) LEVEL--;
          Choice_PID_Exit();
          while(!(gpio_get(key_Exit)));
        }
      }
    }
  }
}